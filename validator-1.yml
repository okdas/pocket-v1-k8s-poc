apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: v1-validator1
spec:
  selector:
    matchLabels:
      app: v1-validator1
  serviceName: v1-validator1
  replicas: 1
  template:
    metadata:
      labels:
        app: v1-validator1
        v1-purpose: validator
    spec:
      containers:
        - name: pocket
          image: poktnetwork/pocket-v1:main-dev
          args:
            - pocket
            - -config=/configs/config.json
          ports:
            - containerPort: 8221
              name: pre2p
            - containerPort: 8222
              name: p2p
          volumeMounts:
            - name: config-volume
              mountPath: /configs
            - name: genesis-volume
              mountPath: /genesis.json
              subPath: genesis.json
            - name: v1-validator1-blockstore
              mountPath: /blockstore
      volumes:
        - name: config-volume
          configMap:
            name: v1-validator1-configs
        - name: genesis-volume
          configMap:
            name: v1-localnet-genesis
  volumeClaimTemplates:
    - metadata:
        name: v1-validator1-blockstore
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 1Gi
---
apiVersion: v1
kind: Service
metadata:
  name: v1-validator1
  labels:
    app: v1-validator1
spec:
  ports:
    - port: 8221
      name: pre2p
    - port: 8222
      name: p2p
  # clusterIP: None
  selector:
    app: v1-validator1
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: v1-validator1-configs
data:
  config.json: |
    {
      "root_dir": "/data",
      "genesis_source": {
        "file": {
          "path": "/genesis.json"
        }
      },
      "private_key": "2e00000000000000000000000000000000000000000000000000000000000000264a0707979e0d6691f74b055429b5f318d39c2883bb509310b67424252e9ef2",
      "p2p": {
        "consensus_port": 8221,
        "use_raintree": true,
        "connection_type": "tcp",
        "protocol": "tcp",
        "address": "0.0.0.0:8222",
        "peers": [
          "v1-validator1:8222",
          "v1-validator-2:8222",
          "v1-validator-3:8222",
          "v1-validator-4:8222"
        ]
      },
      "consensus": {
        "max_mempool_bytes": 500000000,
        "max_block_bytes": 4000000,
        "pacemaker": {
          "timeout_msec": 5000,
          "manual": true,
          "debug_time_between_steps_msec": 1000
        }
      },
      "pre_persistence": {
        "capacity": 99999,
        "mempool_max_bytes": 99999,
        "mempool_max_txs": 99999
      },
      "persistence": {
        "postgres_url": "postgres://postgres:postgres@postgresql:5432/postgres",
        "schema": "validator1",
        "block_store_path": "/blockstore"
      },
      "utility": {},
      "telemetry": {
        "address": "0.0.0.0:9000",
        "endpoint": "/metrics"
      }
    }
